<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ricalcolatore Ricette</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }
    h2 {
      margin-top: 2rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .row input, .row select {
      padding: 0.5rem;
    }
    .btn {
      padding: 0.5rem 1rem;
      background: #2196F3;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .btn:hover {
      background: #1976D2;
    }
    .output {
      margin-top: 2rem;
      padding: 1rem;
      background: #e8f0fe;
      border-radius: 8px;
    }
    .output table {
      width: 100%;
      border-collapse: collapse;
    }
    .output th, .output td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ricalcolatore Ricette</h1>

    <h2>1. Inserisci Ingredienti Manualmente</h2>
    <div id="ingredienti-container"></div>
    <button class="btn" onclick="aggiungiIngrediente()">+ Aggiungi Ingrediente</button>
    <button class="btn" onclick="suddividiIngredienti()">Estrai e Suddividi</button>

    <h2>2. Numero di porzioni</h2>
    <label>Originali: <input type="number" id="porzioni-originali" value="4" /></label>
    <label>Desiderate: <input type="number" id="porzioni-desiderate" value="2" /></label>
    <br/>
    <button class="btn" onclick="ricalcola()">Calcola</button>

    <div class="output" id="output" style="display:none;">
      <h3>Ingredienti Ricalcolati</h3>
      <table>
        <thead>
          <tr>
            <th>Ingrediente</th>
            <th>Originale</th>
            <th>Ricalcolato</th>
          </tr>
        </thead>
        <tbody id="output-body"></tbody>
      </table>
      <button class="btn" onclick="window.print()">Stampa</button>
    </div>
  </div>

  <script>
    const unitaMisura = [
      "g", "kg", "ml", "l", "pz", "cucchiaio", "cucchiaino", "bicchiere", "q.b.", "-"
    ];

    function aggiungiIngrediente(nome='', quantita='', unita='') {
      const container = document.getElementById('ingredienti-container');

      const row = document.createElement('div');
      row.className = 'row';

      const inputNome = document.createElement('input');
      inputNome.placeholder = "Ingrediente";
      inputNome.value = nome;

      const inputQuantita = document.createElement('input');
      inputQuantita.type = 'number';
      inputQuantita.placeholder = "Quantità";
      inputQuantita.value = quantita;

      const selectUnita = document.createElement('select');
      for (const u of unitaMisura) {
        const opt = document.createElement('option');
        opt.value = u;
        opt.text = u;
        if (u === unita) opt.selected = true;
        selectUnita.appendChild(opt);
      }

      row.appendChild(inputNome);
      row.appendChild(inputQuantita);
      row.appendChild(selectUnita);
      container.appendChild(row);
    }

    function suddividiIngredienti() {
      const container = document.getElementById('ingredienti-container');
      const righe = container.querySelectorAll('.row');
      const pattern = /^(.+?)\s*(\d+[\.,]?\d*)\s*(g|kg|ml|l|pz|cucchiaio|cucchiaino|bicchiere|q\.b\.)?$/i;

      righe.forEach(riga => {
        const nomeField = riga.children[0];
        const match = nomeField.value.trim().match(pattern);
        if (match) {
          const [ , ingrediente, quantità, unita ] = match;
          nomeField.value = ingrediente.trim();
          riga.children[1].value = parseFloat(quantità.replace(",", "."));
          if (unita) {
            for (let option of riga.children[2].options) {
              if (option.value.toLowerCase() === unita.toLowerCase()) {
                option.selected = true;
                break;
              }
            }
          }
        }
      });
    }

    function ricalcola() {
      const originali = parseFloat(document.getElementById('porzioni-originali').value);
      const desiderate = parseFloat(document.getElementById('porzioni-desiderate').value);
      const moltiplicatore = desiderate / originali;

      const righe = document.querySelectorAll('#ingredienti-container .row');
      const outputBody = document.getElementById('output-body');
      outputBody.innerHTML = '';

      righe.forEach(riga => {
        const nome = riga.children[0].value;
        const quantita = parseFloat(riga.children[1].value);
        const unita = riga.children[2].value;

        if (!isNaN(quantita)) {
          const ricalcolato = (unita === 'pz' || unita === 'cucchiaio' || unita === 'cucchiaino') 
            ? (quantita * moltiplicatore).toFixed(1) 
            : Math.round(quantita * moltiplicatore);

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${nome}</td>
            <td>${quantita} ${unita}</td>
            <td>${ricalcolato} ${unita}</td>
          `;
          outputBody.appendChild(tr);
        }
      });

      document.getElementById('output').style.display = 'block';
    }

    // Avvia con 3 righe vuote
    aggiungiIngrediente();
    aggiungiIngrediente();
    aggiungiIngrediente();
  </script>
</body>
</html>

